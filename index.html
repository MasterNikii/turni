<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Area Turni Nikita</title>
    <script src="turni.js"></script>
    <style>
        :root { --bg: #0b1120; --card: #1e293b; --accent: #3b82f6; --text: #f1f5f9; --red: #f87171; --green: #4ade80; --orange: #f97316; --timer: #fbbf24; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .wrapper { width: 100%; max-width: 500px; }
        
        #unlock-screen { text-align: center; margin-top: 80px; display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .btn-main { width: 280px; color: white; border: none; padding: 20px; border-radius: 15px; font-size: 1.2em; font-weight: bold; cursor: pointer; background: var(--accent); box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4); }

        .view-section { display: none; width: 100%; }
        .back-btn { background: #1e293b; border: 1px solid #64748b; color: var(--text); padding: 8px 15px; border-radius: 10px; margin-bottom: 20px; cursor: pointer; }

        .card { background: var(--card); border-radius: 18px; margin-bottom: 15px; border: 1px solid #334155; overflow: hidden; }
        .card-header { padding: 18px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .tag-serv { background: var(--accent); padding: 5px 12px; border-radius: 8px; font-size: 0.85em; font-weight: 900; }
        .card-body { display: none; padding: 0; background: #0f172a; border-top: 1px solid #334155; }
        .card.open .card-body { display: block; }

        /* Badge Parcheggio */
        .park-badge { padding: 12px; text-align: center; font-weight: 900; font-size: 1em; margin: 10px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.2); }
        .park-peretola { background: var(--accent); color: white; box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }
        .park-careggi { background: var(--orange); color: white; box-shadow: 0 0 15px rgba(249, 115, 22, 0.5); }

        .viaggio-row { display: flex; padding: 15px; border-bottom: 1px solid #1e293b; }
        .ora-box { min-width: 80px; color: var(--red); font-weight: 800; font-size: 1.1em; text-align: center; }
        .info-col { flex-grow: 1; padding-left: 15px; }
        .tm-label { background: #334155; color: white; padding: 3px 10px; border-radius: 6px; font-weight: bold; font-family: monospace; border: 1px solid var(--accent); }
        .pausa-text { color: var(--green); font-size: 1.1em; margin-top: 10px; font-weight: 800; }
    </style>
</head>
<body>
<div class="wrapper">
    <div id="unlock-screen" style="display:none;">
        <h2 style="color:var(--accent)">Nikita Turni</h2>
        <button class="btn-main" onclick="mostraTurni()">üìÇ APRI TURNI</button>
    </div>

    <div id="view-turni" class="view-section">
        <button class="back-btn" onclick="location.reload()">‚Üê Indietro</button>
        <div id="container-turni"></div>
    </div>
</div>

<script>
    const PIN_HASH = "1509442"; 
    function hashMe(str) { let h = 0; for(let i = 0; i < str.length; i++) h = Math.imul(31, h) + str.charCodeAt(i) | 0; return h.toString(); }
    
    function checkAccesso() {
        if (localStorage.getItem("aut_ok") === "true") { document.getElementById('unlock-screen').style.display = 'flex'; }
        else { let p = prompt("PIN:"); if (p && hashMe(p) === PIN_HASH) { localStorage.setItem("aut_ok", "true"); document.getElementById('unlock-screen').style.display = 'flex'; } else { location.reload(); } }
    }

    function mostraTurni() {
        document.getElementById('unlock-screen').style.display = 'none';
        document.getElementById('view-turni').style.display = 'block';
        if (typeof datiTurni !== 'undefined') generaGrafica(datiTurni);
    }

    function generaGrafica(dati) {
        const container = document.getElementById('container-turni');
        container.innerHTML = "";
        const oggi = new Date().getDate();

        dati.forEach((t) => {
            const card = document.createElement('div');
            card.className = "card";
            if (t.data_estesa.includes(oggi.toString())) card.classList.add('open');
            
            let parkHtml = "";
            if(t.parcheggio === "Peretola") parkHtml = `<div class="park-badge park-peretola">üÖøÔ∏è AUTO A PERETOLA</div>`;
            if(t.parcheggio === "Careggi") parkHtml = `<div class="park-badge park-careggi">üÖøÔ∏è AUTO A CAREGGI</div>`;

            card.innerHTML = `
                <div class="card-header" onclick="this.parentElement.classList.toggle('open')">
                    <span><b>${t.data_estesa}</b></span>
                    <span class="tag-serv">${t.servizio}</span>
                </div>
                <div class="card-body">
                    ${parkHtml}
                    ${generaViaggiGrafici(t.viaggi)}
                </div>`;
            container.appendChild(card);
        });
    }

    function generaViaggiGrafici(viaggi) {
        return viaggi.map(v => `
            <div class="viaggio-row">
                <div class="ora-box">${v.inizio}<br>${v.fine}</div>
                <div class="info-col">
                    <span class="tm-label">TM ${v.tm}</span><br>
                    <div style="font-size:0.9em;color:#cbd5e1;margin-top:5px;">${v.da} > ${v.a}</div>
                    ${v.pausa ? `<div class="pausa-text">‚òï PAUSA: ${v.pausa}</div>` : ''}
                </div>
            </div>`).join('');
    }

    window.onload = checkAccesso;
</script>
</body>
</html>